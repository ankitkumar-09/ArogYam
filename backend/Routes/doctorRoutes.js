const express = require('express');
const router = express.Router();
const doctorController = require('../Controllers/doctorController');
const doctorMiddleware = require('../middlewares/doctorMiddleware');

// Public routes
router.post('/register', doctorController.registerDoctor);
router.post('/login', doctorMiddleware.doctorLoginLimiter, doctorController.loginDoctor);
router.get('/available', doctorController.getAvailableDoctors);

// Protected routes (require authentication)
router.get('/profile', doctorMiddleware.authenticateDoctor, doctorController.getDoctorProfile);
router.put('/profile', doctorMiddleware.authenticateDoctor, doctorController.updateDoctorProfile);

// Slot management (doctor-auth)
router.post('/slots', doctorMiddleware.authenticateDoctor, doctorController.createDoctorSlots);

// Public slot calendar
router.get('/:doctorId/slots', doctorController.getDoctorSlots);

// Admin routes (optional - for admin panel)
router.get('/all', doctorMiddleware.authenticateDoctor, doctorController.getAllDoctors);

// Test route (MUST be before "/:doctorId")
router.get('/test', (req, res) => {
  res.json({
    success: true,
    message: 'Doctor routes are working!',
    timestamp: new Date().toISOString()
  });
});

// Public doctor details (safe) (keep last among simple GETs)
router.get('/:doctorId', doctorController.getDoctorByIdPublic);

module.exports = router;